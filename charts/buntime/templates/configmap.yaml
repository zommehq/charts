# AUTO-GENERATED FILE - DO NOT EDIT
# Generated by: bun scripts/generate-helm-configmap.ts
# Source: charts/configmap.base.yaml + plugins/*/manifest.yaml
#
# To regenerate: bun scripts/generate-helm.ts

# Buntime Helm Chart - Base ConfigMap (Runtime Only)
# To regenerate: bun scripts/generate-helm.ts
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "buntime.fullname" . }}
  labels:
    {{- include "buntime.labels" . | nindent 4 }}
data:
  # Runtime configuration
  LOG_LEVEL: {{ .Values.buntime.logLevel | quote }}
  NODE_ENV: "production"
  PLUGIN_DIRS: {{ .Values.buntime.pluginDirs | quote }}
  POOL_SIZE: {{ .Values.buntime.poolSize | quote }}
  PORT: {{ .Values.buntime.port | quote }}
  RUNTIME_API_PREFIX: {{ .Values.buntime.apiPrefix | default "" | quote }}
  WORKER_DIRS: {{ .Values.buntime.workerDirs | quote }}

  # Database plugin
  DATABASE_LIBSQL_URL: {{ .Values.plugins.database.libsqlUrl | default "http://libsql:8080" | quote }}
  {{- if .Values.plugins.database.libsqlReplicas }}
  {{- if kindIs "string" .Values.plugins.database.libsqlReplicas }}
  {{- /* Handle multiline string from Rancher UI */}}
  {{- $lines := splitList "\n" .Values.plugins.database.libsqlReplicas }}
  {{- $index := 0 }}
  {{- range $lines }}
  {{- $val := trim . }}
  {{- if $val }}
  {{- $index = add $index 1 }}
  DATABASE_LIBSQL_REPLICAS_{{ $index }}: {{ $val | quote }}
  {{- end }}
  {{- end }}
  {{- else }}
  {{- /* Handle array from values.yaml */}}
  {{- range $index, $val := .Values.plugins.database.libsqlReplicas }}
  DATABASE_LIBSQL_REPLICAS_{{ add $index 1 }}: {{ $val | quote }}
  {{- end }}
  {{- end }}
  {{- end }}
  {{- if .Values.plugins.database.libsqlAuthToken }}
  DATABASE_LIBSQL_AUTH_TOKEN: {{ .Values.plugins.database.libsqlAuthToken | quote }}
  {{- end }}

  # Deployments plugin
  DEPLOYMENTS_EXCLUDES: {{ .Values.plugins.deployments.excludes | default ".cache, cli, runtime" | quote }}

  # Gateway plugin
  GATEWAY_APP_SHELL: {{ .Values.plugins.gateway.appShell | default "" | quote }}
  GATEWAY_RATE_LIMIT_REQUESTS: {{ .Values.plugins.gateway.rateLimit.requests | default "100" | quote }}
  GATEWAY_RATE_LIMIT_WINDOW: {{ .Values.plugins.gateway.rateLimit.window | default "1m" | quote }}
  GATEWAY_CORS_ORIGIN: {{ .Values.plugins.gateway.cors.origin | default "*" | quote }}
  {{- if .Values.plugins.gateway.cors.credentials }}
  GATEWAY_CORS_CREDENTIALS: "true"
  {{- end }}
